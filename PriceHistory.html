<!DOCTYPE html>
<html lang="en">
<head>
    <script src="auth-storage.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Market Tracker</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="app-config.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="topbar.js"></script>
    <link rel="stylesheet" href="css/pages/pricehistory.css">
    <!-- NOTE: this repo currently ships `css/pages/pricehistory.css` (lowercase). Keep as-is to avoid breaking. -->
    <link rel="stylesheet" href="css/site-layout.css">
    <link rel="stylesheet" href="css/panels-paper.css">
    <link rel="stylesheet" href="css/shared/universal-dropdown.css">
    <script src="shared/site-decor.js"></script>
    <script src="shared/universal-dropdown.js"></script>
</head>

<body class="no-side-decor">
    <h1>Item Market History</h1>

    <div id="controls">
        <label>
            Sheet (Buy/Sell):
            <select id="typeSelect">
                <option value="SellHistory" selected>Buy Prices (SellHistory)</option>
                <option value="BuyHistory">Sell Prices (BuyHistory)</option>
            </select>
        </label>

        <div class="itemSelectBlock">
            <div style="display:flex; align-items:center; gap:.5rem;">
                <div style="font-weight:700; color:#374151;">Items</div>
                <button class="infoBtn" type="button" data-info="controls" title="How to use">More info</button>
            </div>

            <div class="itemSelectRow">
                <div class="dropdown-wrap" style="flex:1;">
                    <input id="itemSearchInput" class="dropdown-input" placeholder="Search items..." style="width:100%;" />
                    <div id="itemSearchInputList" class="dropdown-list" style="display:none;"></div>
                </div>
                <button id="addItemBtn" type="button">Add</button>
                <button id="applyItemsBtn" type="button" class="primary">Apply</button>
                <button id="clearItemsBtn" type="button">Clear</button>
            </div>

            <div id="selectedItemsChips"></div>
        </div>

        <label>
            Time Range:
            <select id="rangeSelect">
                <option value="7">Last7 days</option>
                <option value="30">Last30 days</option>
                <option value="180">Last6 months</option>
                <option value="365">Last year</option>
                <option value="all" selected>All history</option>
            </select>
        </label>

        <div class="selectWithInfo">
            <label>
                Middle Chart Metric:
                <select id="metricSelect">
                    <option value="stock" selected>Stock Amount</option>
                    <option value="change">Daily Price Change (+/-)</option>
                    <option value="changePct">Daily Price Change (%)</option>
                    <option value="valuation">Total Valuation</option>
                    <option value="goal">Goal Stock %</option>
                    <option value="targetStock">Target stock stack</option>
                </select>
            </label>
            <button class="infoBtn" type="button" data-info="metricSystem" title="About metrics">More info (metrics)</button>
        </div>

        <div class="selectWithInfo">
            <label>
                Inflation Index Category:
                <select id="indexSelect">
                    <option value="median" selected>Median Item Inflation Index (Weighted)</option>
                    <option value="metals">Metal Index (Weighted)</option>
                    <option value="common">Common Items Index (Weighted)</option>
                    <option value="selected">Selected items index (Weighted)</option>
                </select>
            </label>
            <button class="infoBtn" type="button" data-info="indexSystem" title="About categories">More info (categories)</button>
        </div>

        <div id="selectedItemImages" aria-label="Selected item images"></div>

        <div id="warningBox" role="status" aria-live="polite"></div>
    </div>

    <div id="charts">
        <div class="chart-card">
            <div class="chart-header">
                <div>
                    <div class="chart-title">
                        Price Trend
                        <button class="infoBtn" type="button" data-info="price" title="About Price Trend">More info</button>
                    </div>
                    <div class="chart-meta">History of recorded prices</div>
                </div>
                <div class="toggles">
                    <label class="toggleRow"><input type="checkbox" id="toggleCombinedPrice" /> Show combined</label>
                    <label class="toggleRow"><input type="checkbox" id="toggleNormalizeCombined" /> Normalize combined to100</label>
                </div>
            </div>
            <div class="chart-body">
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
                <div class="legend" id="priceLegend" aria-label="Price chart legend"></div>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <div>
                    <div class="chart-title" id="middleChartTitle">
                        Stock History
                        <button class="infoBtn" type="button" data-info="middleDynamic" title="About this metric">More info</button>
                    </div>
                    <div class="chart-meta" id="middleChartDesc">Metric for selected items</div>
                </div>
                <div class="toggles">
                    <label class="toggleRow"><input type="checkbox" id="toggleCombinedMiddle" /> Show combined sum</label>
                </div>
            </div>
            <div class="chart-body">
                <div class="chart-wrapper">
                    <canvas id="metricChart"></canvas>
                </div>
                <div class="legend" id="middleLegend" aria-label="Middle chart legend"></div>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <div>
                    <div class="chart-title" id="inflationChartTitle">
                        Inflation Index (base=100)
                        <button class="infoBtn" type="button" data-info="inflationDynamic" title="About this category">More info</button>
                    </div>
                    <div class="chart-meta" id="inflationChartDesc">
                        Weighted median of per-item price inflation factors. Weight = stock value (BT)/1000 (prefers ValuationHistory; falls back to stock*price).
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="inflationChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" role="dialog" aria-modal="true" aria-labelledby="infoModalTitle">
        <div class="modalCard">
            <div class="modalHeader">
                <div class="modalTitle" id="infoModalTitle">Info</div>
                <button class="modalClose" id="infoModalClose" type="button">Close</button>
            </div>
            <div id="infoModalBody"></div>
        </div>
    </div>

    <!-- PriceHistory scripts -->
    <script src="pricehistory_js/pricehistory-config.js"></script>
    <script src="pricehistory_js/pricehistory-utils.js"></script>
    <script src="pricehistory_js/pricehistory-data.js"></script>
    <script src="pricehistory_js/pricehistory-processing.js"></script>
    <script src="pricehistory_js/pricehistory-charts.js"></script>
    <script src="pricehistory_js/pricehistory-helptext.js"></script>
    <script src="pricehistory_js/pricehistory-storage.js"></script>
    <script src="pricehistory_js/pricehistory-ui.js"></script>
    <script src="pricehistory_js/pricehistory-boot.js"></script>
</body>
</html>